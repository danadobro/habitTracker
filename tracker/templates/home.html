<!--HTMl File-->
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'tracker/style.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <title>Habit Tracker</title>
</head>

<body>

    <header>
        <div class="nav">

            {% load static %}
            <img src="{% static 'tracker/habit_tracker_logo.png' %}" class="logo" alt="logo">

            
            <a href="#user"> <h2>Welcome, {{ request.user.username }}</h2></a>
            <a href="#home"> Home</a>
            <a href="#allhabits"> Habits</a>
            <a href="#goals"> Goals</a>
            <a href="#history"> History</a>

            <!--For the navigation, user id, search-->

        </div>
    </header>



    <div class="page-wrapper">
        <div class="main">


            <div class="today-section">
                <h2>TODAY: <span class="today-date" id="today-date"> {{ today_str }} </span></h2> 

                <ul id="today-habits"></ul>

            </div>

            <div class="form1">
                <h2>HABITS</h2>
                <div class="habits" id="habit-container">
                    <!--To display habits and their info-->
                    
                    <ol>
                        {% for habit in habits %}
                        <div class="habit">
                            <h3> <li>{{ habit.name }} </h3>
                                <p>{{ habit.days_completed }}/{{ habit.target }} completed </p> 
                                <form method="POST" action="{% url 'mark_complete' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="habit_id" value="{{ habit.id }}">
                                    <input type="hidden" name="date" value="{{ today }}">

                                    <div class="progress-container">
                                        <div class="progress-bar" style="width: {{habit.progress}}%;"></div>
                                    </div>

                                    {% if today in habit.logs %}
                                        <button type="submit" disabled class="completed-button">Completed Today</button>
                                    {% else %}
                                        <button type="submit">Mark as Completed Today</button>
                                    {% endif %}
                                    
                                </form>
                            </div>
                            </li>
                            
                        {% empty %}
                            <li>You haven't added any habits yet.</li>
                        {% endfor %}
                    
                    </ol>
                    
                </div>
                <button id="addNewBtn">+ Add New Habit</button>
                <div id="habitform" class="hidden">
                    <form method="POST" action="{% url 'add_habit' %}">
                        {% csrf_token %}
                    
                        <h2> New Habit</h2>
                    
                        <input type="text" name="habit_name" placeholder="Habit Name" required>
                    
                        <label for="target">Target days:</label>
                        <input type="number" name="target" min="1" max="28" required>
                
                        <button type="submit">Save Habit</button>
                    </form>
                </div>
            </div>
        </div>
    

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addBtn = document.getElementById('addNewBtn');
            const formDiv = document.getElementById('habitform');
    
            addBtn.addEventListener('click', () => {
                formDiv.classList.toggle('hidden');
            });
        });
    </script>
</body>

</html>